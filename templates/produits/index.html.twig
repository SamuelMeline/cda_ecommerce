{% extends 'base.html.twig' %}

{% block title %}
	Produits
{% endblock %}

{% block body %}
	<div class="container">
		<h1>Produits</h1>
		<h2 class="text-info">Rechercher un produit</h2>

		<div
			class="flex">
			{# Filtrer par catégorie #}
			<form class="search" method="post" action="{{ path('app_produits_categorie') }}">
				<div class="form-group">
					<label for="categorie">Catégorie</label>
					<select name="categorie_id" id="categorie" class="form-control">
						{% for categorie in categories %}
							<option value="{{ categorie.id }}" {% if categorie.id == selected_categorie|default('') %} selected {% endif %}>
								{{ categorie.name }}
							</option>
						{% endfor %}
					</select>
				</div>
				<button type="submit" class="btn btn-primary">Filtrer</button>
			</form>

			{# Filtrer par distributeur #}
			<form class="search" method="post" action="{{ path('app_produits_distributeur') }}">
				<div class="form-group">
					<label for="distributeur">Distributeur</label>
					<select name="distributeur_id" id="distributeur" class="form-control">
						{% for distributeur in distributeurs %}
							<option value="{{ distributeur.id }}" {% if distributeur.id == selected_distributeur|default('') %} selected {% endif %}>
								{{ distributeur.name }}
							</option>
						{% endfor %}
					</select>
				</div>
				<button type="submit" class="btn btn-primary">Filtrer</button>
			</form>
		</div>

		<div class="row">
    {% for produit in produits %}
        <div class="col-md-3 mb-4">
            <div class="card">
                <div id="carouselExampleAutoplaying{{ produit.id }}" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        {% for image in produit.photos %}
                            <div class="carousel-item {% if loop.first %}active{% endif %}">
                                <img src="{{ asset('uploads/images/' ~ image.name) }}" class="d-block w-100" alt="{{ produit.name }}">
                            </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying{{ produit.id }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying{{ produit.id }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </button>
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{ produit.name }}</h5>
                    <p class="card-text mt-3">
                        {% if produit.description|length > 50 %}
                            {{ produit.description|slice(0, 50) }}...
                        {% else %}
                            {{ produit.description }}
                        {% endif %}
                    </p>
                    <p class="card-text">Référence: {{ produit.reference.name }}</p>
                    <p class="card-text">Catégorie: {{ produit.categorie.name }}</p>
                    <p class="card-text">Distributeurs: 
                        {% for distributeur in produit.distributeur %}
                            {{ distributeur.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                    <p class="card-text">Prix: <strong>{{ produit.price }}€</strong></p>
                    <p class="card-text">Créé le: {{ produit.createdAt|date('d/m/Y H:i') }}</p>
                    <p class="card-text">Mis à jour le: {{ produit.updatedAt|date('d/m/Y H:i') }}</p>
                    <div class="flex boutton-card">
                        <a href="{{ path('app_produits_show', {'id': produit.id}) }}" class="btn btn-primary">Voir</a>
                        <a href="{{ path('app_produits_edit', {'id': produit.id}) }}" class="btn btn-warning">Modifier</a>
                    </div>
                    <div class="flex boutton-card">
                        <a href="{{ path('app_panier', {'id': produit.id}) }}" class="btn btn-success mt-3">Ajout panier</a>
                        {{ include('produits/_delete_form.html.twig') }}
                    </div>
                </div>
            </div>
        </div>
		{% else %}
			<div class="col">
				<p>Aucun produit trouvé.</p>
			</div>
		{% endfor %}
	</div>
	<a class="btn btn-success" href="{{ path('app_produits_new') }}">Créer un nouveau produit</a>
	<a class="btn btn-secondary" href="{{ path('app_home') }}">Retour à l'accueil</a>
	{# Si on est sur /categorie-produit afficher le boutton #}
	{% if app.request.attributes.get('_route') == 'app_produits_categorie' %}
		<a class="btn btn-secondary" href="{{ path('app_produits_index') }}">Retour à tous les produits</a>
	{% endif %}
</div>{% endblock %}
